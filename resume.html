<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>ElevateCV — Resume Builder (Fixed)</title>
  <style>
    body {
      background: #ffffff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    #editor {
      display: flex !important;
      align-items: flex-start;
      gap: 24px;
      width: 100%;
      height: 100%;
    }

    #sidebar {
      width: 220px;
      background: white;
      border-right: 1px solid #ddd;
      border-radius: 0;
      padding: 16px;
      box-shadow: none;
      height: 100%;
      flex-shrink: 0;
      position: relative;
      z-index: 99999 !important;
    }

    #resume {
      transform-origin: top center;
      width: 600px;
      min-height: 820px;
      background: white;
      padding: 40px;
      border: 1px solid #ccc;
      outline: none;
      margin: 40px auto;
      position: relative;
      z-index: 1 !important;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.08);
      border-radius: 6px;
    }

    .text-box,
    .shape-line,
    .shape-box {
      position: absolute;
      cursor: move;
      box-sizing: border-box;
      z-index: 500 !important;
    }

    .text-box {
      min-width: 120px;
      padding: 6px;
      border: 1px dashed #555;
      background: transparent;
    }

    .text-box .box-controls {
      position: absolute;
      top: -26px;
      right: 0;
      background: #333;
      color: white;
      padding: 3px 6px;
      border-radius: 4px;
      font-size: 12px;
      display: none;
      white-space: nowrap;
    }

    .text-box:hover .box-controls {
      display: inline-block;
    }

    .shape-line {
      width: 200px;
      height: 2px;
      background: black;
    }

    .shape-box {
      width: 150px;
      height: 80px;
      border: 2px solid black;
      background: transparent;
    }

    #context-menu {
      position: absolute;
      background: white;
      border: 1px solid #aaa;
      border-radius: 6px;
      display: none;
      z-index: 9999;
      min-width: 150px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      font-size: 14px;
      overflow: hidden;
    }

    #context-menu div {
      padding: 10px 12px;
      cursor: pointer;
    }

    #context-menu div:hover {
      background: #f5f5f5;
    }
  </style>
</head>

<body>

  <div id="context-menu">
    <div onclick="cmDelete()">Delete</div>
    <div onclick="cmDuplicate()">Duplicate</div>
    <div onclick="cmFront()">Bring to Front</div>
    <div onclick="cmBack()">Send to Back</div>
  </div>

  <div id="editor">

    <!-- ✅ ZOOM BAR FIXED -->
    <div id="zoom-bar"
      style="position:fixed; top:12px; left:260px; z-index:99999; background:white; padding:6px 10px; border-radius:6px; border:1px solid #ddd; box-shadow:0 2px 6px rgba(0,0,0,0.06);">
      Zoom:
      <button id="zoom-out">-</button>
      <input type="range" id="zoom-slider" min="50" max="200" value="100" style="vertical-align:middle;">
      <button id="zoom-in">+</button>
    </div>

    <div id="sidebar">
      <h3>Tools</h3>
      <button onclick="addTextBox()">Text Box</button>
      <button onclick="addLine()">Line</button>
      <button onclick="addBox()">Box</button>

      <h3>Export</h3>
      <button onclick="downloadPDF()">PDF</button>
      <button onclick="downloadPNG()">PNG</button>
      <button onclick="downloadJPG()">JPG</button>
    </div>

    <div id="resume" contenteditable="true">
      <h1>Your Name</h1>
      <p>Job Title</p>
    </div>

  </div>

  <!-- Required Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    let resumeEl = document.getElementById('resume');
    let currentDrag = null, offsetX = 0, offsetY = 0;
    let currentSelected = null;

    /* ✅ Zoom Function */
    const zoomSlider = document.getElementById('zoom-slider');
    const zoomInBtn = document.getElementById('zoom-in');
    const zoomOutBtn = document.getElementById('zoom-out');

    let zoomLevel = 1;

    function applyZoom() {
      resumeEl.style.transform = `scale(${zoomLevel})`;
      resumeEl.style.transformOrigin = "top center";
    }

    zoomSlider.addEventListener('input', function () {
      zoomLevel = this.value / 100;
      applyZoom();
    });

    zoomInBtn.addEventListener('click', () => {
      zoomLevel = Math.min(zoomLevel + 0.1, 2);
      zoomSlider.value = zoomLevel * 100;
      applyZoom();
    });

    zoomOutBtn.addEventListener('click', () => {
      zoomLevel = Math.max(zoomLevel - 0.1, 0.5);
      zoomSlider.value = zoomLevel * 100;
      applyZoom();
    });

    applyZoom();

    /* Dragging */
    function startDrag(e) {
      const el = e.target.closest('.text-box, .shape-line, .shape-box');
      if (!el) return;
      currentDrag = el;
      const rect = resumeEl.getBoundingClientRect();
      offsetX = e.clientX - el.getBoundingClientRect().left;
      offsetY = e.clientY - el.getBoundingClientRect().top;
      document.onmousemove = drag;
      document.onmouseup = stopDrag;
    }

    function drag(e) {
      if (!currentDrag) return;
      const rect = resumeEl.getBoundingClientRect();
      currentDrag.style.left = (e.clientX - rect.left - offsetX) + 'px';
      currentDrag.style.top = (e.clientY - rect.top - offsetY) + 'px';
    }

    function stopDrag() { currentDrag = null; document.onmousemove = null; }

    function addTextBox() {
      const box = document.createElement('div');
      box.className = 'text-box';
      box.contentEditable = 'true';
      box.style.left = '80px'; box.style.top = '80px';
      box.innerHTML = 'Type here<div class="box-controls"><span onclick="deleteBox(this)">✖</span><span onclick="duplicateBox(this)">➕</span></div>';
      box.onmousedown = startDrag;
      resumeEl.appendChild(box);
    }

    function addLine() {
      const l = document.createElement('div');
      l.className = 'shape-line';
      l.style.left = '150px'; l.style.top = '150px';
      l.onmousedown = startDrag;
      resumeEl.appendChild(l);
    }

    function addBox() {
      const b = document.createElement('div');
      b.className = 'shape-box';
      b.style.left = '200px'; b.style.top = '200px';
      b.onmousedown = startDrag;
      resumeEl.appendChild(b);
    }

    function deleteBox(btn) { btn.closest('.text-box,.shape-line,.shape-box').remove(); }
    function duplicateBox(btn) {
      const el = btn.closest('.text-box,.shape-line,.shape-box');
      const c = el.cloneNode(true);
      c.style.left = (el.offsetLeft + 30) + 'px';
      c.style.top = (el.offsetTop + 30) + 'px';
      c.onmousedown = startDrag;
      resumeEl.appendChild(c);
    }

    function downloadPDF() { html2pdf().from(resumeEl).save(); }
    function downloadPNG() { html2canvas(resumeEl, { scale: 2 }).then(c => { const a = document.createElement('a'); a.download = 'resume.png'; a.href = c.toDataURL(); a.click(); }); }
    function downloadJPG() { html2canvas(resumeEl, { scale: 2 }).then(c => { const a = document.createElement('a'); a.download = 'resume.jpg'; a.href = c.toDataURL('image/jpeg', 1.0); a.click(); }); }

    resumeEl.addEventListener('mousedown', startDrag);
  </script>

</body>

</html>
